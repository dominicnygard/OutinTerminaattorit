<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body class="light">
    <!-- Theme button -->
    <button id="theme-button">ðŸŽ„</button>

    <!-- â„ï¸ Snowflakes container -->
    <div class="snowflakes" id="snowflakes" aria-hidden="true"></div>

    {% block content %}{% endblock %} {% block body %}{% endblock %}

    <link
      href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <script>
      const body = document.body;
      const themeButton = document.getElementById("theme-button");
      const snowContainer = document.getElementById("snowflakes");
      const FLAKE_COUNT = 36;

      const createSnowflakes = () => {
        if (!snowContainer) return;
        snowContainer.innerHTML = "";
        for (let i = 0; i < FLAKE_COUNT; i += 1) {
          const flake = document.createElement("div");
          flake.className = "snowflake";
          flake.style.left = `${Math.random() * 100}%`;
          flake.style.animationDelay = `${(Math.random() * 2).toFixed(2)}s`;
          flake.style.animationDuration = `${(2 + Math.random() * 2).toFixed(
            2
          )}s`;

          const inner = document.createElement("div");
          inner.className = "inner";
          inner.textContent = Math.random() > 0.5 ? "â…" : "â†";
          inner.style.animationDuration = `${(8 + Math.random() * 6).toFixed(
            2
          )}s`;
          inner.style.animationDelay = `${(Math.random() * 3).toFixed(2)}s`;

          flake.appendChild(inner);
          snowContainer.appendChild(flake);
        }
      };

      const applyTheme = (theme) => {
        body.classList.remove("light", "christmas");
        body.classList.add(theme);
        localStorage.setItem("theme", theme);
        if (theme === "christmas") {
          createSnowflakes();
        }
      };

      const savedTheme = localStorage.getItem("theme") || "light";
      applyTheme(savedTheme);

      window.addEventListener("pageshow", () => {
        const persistedTheme = localStorage.getItem("theme") || "light";
        applyTheme(persistedTheme);
      });

      themeButton.addEventListener("click", () => {
        const newTheme = body.classList.contains("light")
          ? "christmas"
          : "light";
        applyTheme(newTheme);
      });

      window.addEventListener("resize", () => {
        if (body.classList.contains("christmas")) {
          createSnowflakes();
        }
      });
    </script>

    <style>
      /* customizable snowflake styling */
      .snowflake {
        color: #fff;
        font-size: 1em;
        font-family: Arial, sans-serif;
        text-shadow: 0 0 5px #fff;
      }

      .snowflake,
      .snowflake .inner {
        animation-iteration-count: infinite;
        animation-play-state: running;
      }
      @keyframes snowflakes-fall {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(110vh);
        }
      }
      @keyframes snowflakes-shake {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(80px);
        }
      }

      .snowflakes {
        position: fixed;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: 9999;
      }

      .snowflake {
        position: absolute;
        top: -10%;
        -webkit-user-select: none;
        user-select: none;
        cursor: default;
        animation-name: snowflakes-shake;
        animation-duration: 3s;
        animation-timing-function: ease-in-out;
      }

      .snowflake .inner {
        animation-duration: 10s;
        animation-name: snowflakes-fall;
        animation-timing-function: linear;
      }

      /* HIDE SNOWFLAKES unless in Christmas mode */
      body:not(.christmas) .snowflakes {
        display: none;
      }
    </style>
  </body>
</html>
